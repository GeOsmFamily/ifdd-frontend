<div class="fixed md:pt-20 pl-0 md:pl-5 pr-0 md:pr-5 md:top-0 bottom-0 left-0 right-0 md:right-auto md:w-[400px] md:bg-secondary md:z-0 overflow-y-auto" [ngClass]="{'top-0 z-20': isOpen() && !showOrgs, 'top-12': !isOpen(), 'top-0 bg-secondary': isOpen() && showOrgs}">
  <app-search-bar class="hidden md:block mt-5" [isRounded]="!showOrgs"></app-search-bar>
  <div *ngIf="!showOrgs" class="relative flex flex-col md:mt-3 bg-white rounded-lg shadow-lg" [ngClass]="{'pb-14': isOpen(), 'mt-2 mx-3': !isOpen()}">
    <h2 class="flex items-center justify-center md:pt-4 md:pb-5 text-xs md:text-sm text-secondary text-center md:text-left font-semibold" [ngClass]="{'pb-4 pt-4 px-7': isOpen(), 'pb-2 pt-2 px-4': !isOpen()}">
      {{ 'title.filter_by_objectives'|translate }}
      <button *ngIf="isOpen()" class="md:hidden ml-auto text-primary" (click)="toggle()">
        <ng-icon name="hero-x" size="24"></ng-icon>
      </button>
    </h2>
    <button *ngIf="!isOpen()" class="text-primary" (click)="toggle()">
      <ng-icon name="hero-chevron-down" strokeWidth="3"></ng-icon>
    </button>
    <ng-scrollbar [autoHeightDisabled]="false" *ngIf="isOpen()">
      <div class="group px-7 flex-1 max-h-[calc(100vh-116px)] md:max-h-[calc(100vh-300px)]">
        <app-loading-lines *ngIf="loading"></app-loading-lines>
        <div *ngFor="let item of odds" class="last:pb-10">
          <app-odd [odd]="item" [selected]="item === selectedOdd" [lite]="false" (categoriesSelection)="onCategoriesSelection($event)" (click)="onSelectOdd(item)"></app-odd>
        </div>
      </div>
    </ng-scrollbar>
    <div *ngIf="isOpen() && selectedOrgsCount() !== 0" class="absolute bottom-0 left-0 right-0 flex px-5 py-3 bg-white rounded-b-lg shadow-[0px_-5px_10px_rgb(0,0,0,.2)]">
      <button *ngIf="selectedOdd" class="p-2 bg-secondary-light text-primary text-xs font-extrabold rounded-lg uppercase" (click)="reinitialize()">{{ 'button.reinitialize'|translate }}</button>
      <button class="p-2 ml-auto bg-accent text-primary text-xs font-extrabold rounded-lg uppercase" (click)="onShowOrgs()">{{ 'button.display_orgs'|translate:{orgsCount: selectedOrgsCount()} }}</button>
    </div>
  </div>
  <div *ngIf="showOrgs" class="relative flex flex-col pt-14 md:pt-0 pb-5 px-3 md:px-0" [ngClass]="{'mt-2 mx-3': !isOpen()}" [ngClass]="{'md:mt-3': !showOrgs}">
    <div class="flex flex-col items-center justify-center p-3 bg-white shadow-lg border-t-neutral-200 border-t" [ngClass]="{'rounded-lg': mobileQuery.matches || (!mobileQuery.matches && !showOrgs), 'rounded-b-lg': !mobileQuery.matches && showOrgs}">
      <div class="w-full flex" [ngClass]="{'mb-3': selectedCategories.length !== 0}">
        <app-odd-category [category]="category" *ngFor="let category of selectedCategories; let i = index;" [color]="selectedOdd?.color" (unselectCategory)="unselectCategory(i)"></app-odd-category>
      </div>
      <button class="flex text-primary text-xs md:text-sm font-bold items-center lowercase" (click)="hideOrgs()">
        <span>{{ 'button.update_filters'|translate }}</span>
        <ng-icon name="hero-chevron-down" strokeWidth="3" class="inline-flex ml-4"></ng-icon>
      </button>
    </div>
    <div class="flex mt-3 md:mt-2 mb-3 md:mb-4">
      <p class="font-bold text-sm text-white">
        <span>{{ orgs.length }} </span>
        <span *ngIf="orgs.length === 1">{{ 'text.one_org'|translate }}</span>
        <span *ngIf="orgs.length !== 1">{{ 'text.orgs_count'|translate }}</span>
      </p>
      <button class="ml-auto font-bold text-sm text-white">
        {{ 'button.filter_by_relevance'|translate }}
        <ng-icon name="hero-chevron-down" strokeWidth="3"></ng-icon>
      </button>
    </div>
    <app-org [org]="org" *ngFor="let org of orgs" (click)="onSelectOrg(org)"></app-org>
  </div>
</div>

<div class="fixed z-20 md:z-0 md:pt-20 top-0 bottom-0 left-0 right-0 md:right-auto md:translate-x-[400px] md:w-[400px] bg-white transition-transform" *ngIf="selectedOrg">
  <ng-scrollbar [autoHeightDisabled]="false">
    <app-org-details [selectedOrg]="selectedOrg" (hide)="onCloseOrgDetails()"></app-org-details>
  </ng-scrollbar>
</div>
